# ğŸ”„ CI/CD Workflow Diagram - Samaanai

Visual guide to understanding the deployment pipeline.

## ğŸŒŠ Deployment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Developer Workflow                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Feature    â”‚
â”‚  Development â”‚  Developer creates feature branch
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pull Request â”‚  Create PR: feature/* â†’ staging
â”‚  to Staging  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Merge âœ“
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Staging Branch                               â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“¦ Project: samaanai-staging                                   â”‚
â”‚  ğŸš€ Service: samaanai-backend-staging                          â”‚
â”‚  ğŸ’° Resources: 512MB, 0-10 instances                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GitHub Actions Triggered
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Automated CI/CD Pipeline                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Test   â”‚ â”€â†’ â”‚  Build   â”‚ â”€â†’ â”‚  Deploy  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚       â”‚               â”‚                â”‚                        â”‚
â”‚   Run Tests      Build Docker    Deploy to GCP                 â”‚
â”‚   âœ“ Pass         Push to GCR     Run Migrations                â”‚
â”‚                                   Health Check                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Deployment Complete
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Staging    â”‚  ğŸ§ª Test in staging environment
â”‚  Environment â”‚  URL: https://samaanai-backend-staging-xxx.run.app
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ QA & Testing
       â”‚ âœ“ All tests pass
       â”‚ âœ“ Manual verification
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pull Request â”‚  Create PR: staging â†’ main
â”‚ to Productionâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Code Review & Approval
       â”‚ Merge âœ“
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Main Branch (Production)                     â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“¦ Project: samaanai-prod                                      â”‚
â”‚  ğŸš€ Service: samaanai-backend                                   â”‚
â”‚  ğŸ’° Resources: 1GB, 1-100 instances                             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ GitHub Actions Triggered
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Automated CI/CD Pipeline                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   Test   â”‚ â”€â†’ â”‚  Build   â”‚ â”€â†’ â”‚  Deploy  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚       â”‚               â”‚                â”‚                        â”‚
â”‚   Run Tests      Build Docker    Deploy to GCP                 â”‚
â”‚   âœ“ Pass         Push to GCR     Run Migrations                â”‚
â”‚                                   Health Check                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Deployment Complete
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Production   â”‚  ğŸ‰ Live to users!
â”‚ Environment  â”‚  URL: https://samaanai-backend-xxx.run.app
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”€ Branch Strategy

```
main (ğŸš€ Production)
  â”œâ”€â”€â”€ Always deployable
  â”œâ”€â”€â”€ Protected branch
  â””â”€â”€â”€ Requires PR review
       â†‘
       â”‚ PR & Review
       â”‚
staging (ğŸ§ª Staging)
  â”œâ”€â”€â”€ Pre-production testing
  â”œâ”€â”€â”€ Integration testing
  â””â”€â”€â”€ QA validation
       â†‘
       â”‚ PR from feature branches
       â”‚
feature/new-feature (ğŸ’» Development)
feature/bug-fix
feature/enhancement
  â””â”€â”€â”€ Active development
```

## ğŸ¯ Trigger Matrix

| Git Action | Branch | Environment | Auto-Deploy | Resource Config |
|------------|--------|-------------|-------------|-----------------|
| Push | `staging` | Staging | âœ… Yes | 512MB, 0 min |
| Push | `main` | Production | âœ… Yes | 1GB, 1 min |
| Manual | Any | Staging | âš™ï¸ Manual | 512MB, 0 min |
| Manual | Any | Production | âš™ï¸ Manual | 1GB, 1 min |

## ğŸ”„ GitHub Actions Workflow Steps

### Job 1: Setup (Determine Environment)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Setup Environment           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Check Trigger Type         â”‚   â”‚
â”‚  â”‚  - Push to main? â†’ prod     â”‚   â”‚
â”‚  â”‚  - Push to staging? â†’ stage â”‚   â”‚
â”‚  â”‚  - Manual? â†’ user choice    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â†“                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Set Environment Variables  â”‚   â”‚
â”‚  â”‚  - project-id               â”‚   â”‚
â”‚  â”‚  - service-name             â”‚   â”‚
â”‚  â”‚  - environment              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
   Output to Test & Deploy jobs
```

### Job 2: Test

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Run Tests                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  1. Checkout code                   â”‚
â”‚  2. Setup Node.js 18                â”‚
â”‚  3. Install dependencies            â”‚
â”‚  4. Generate Prisma Client          â”‚
â”‚  5. Run npm test                    â”‚
â”‚                                     â”‚
â”‚  âœ“ Tests must pass to continue      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
   Tests passed? Continue to Deploy
```

### Job 3: Deploy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Build & Deploy                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  1. Checkout code                                   â”‚
â”‚  2. Authenticate to GCP                             â”‚
â”‚     â”œâ”€ Use staging SA key (if staging)             â”‚
â”‚     â””â”€ Use production SA key (if prod)             â”‚
â”‚                                                     â”‚
â”‚  3. Configure Docker for GCR                        â”‚
â”‚                                                     â”‚
â”‚  4. Build Docker Image                              â”‚
â”‚     â”œâ”€ Tag: commit-sha                             â”‚
â”‚     â”œâ”€ Tag: latest                                 â”‚
â”‚     â””â”€ Tag: environment (staging/production)       â”‚
â”‚                                                     â”‚
â”‚  5. Push Docker Image to GCR                        â”‚
â”‚                                                     â”‚
â”‚  6. Deploy to Cloud Run                             â”‚
â”‚     â”œâ”€ Set environment variables                   â”‚
â”‚     â”œâ”€ Inject secrets from Secret Manager         â”‚
â”‚     â”œâ”€ Configure resources (based on env)          â”‚
â”‚     â””â”€ Set labels and metadata                     â”‚
â”‚                                                     â”‚
â”‚  7. Run Database Migrations                         â”‚
â”‚     â”œâ”€ Create Cloud Run Job                       â”‚
â”‚     â”œâ”€ Execute: npx prisma migrate deploy         â”‚
â”‚     â””â”€ Clean up job                               â”‚
â”‚                                                     â”‚
â”‚  8. Get Service URL                                 â”‚
â”‚                                                     â”‚
â”‚  9. Health Check                                    â”‚
â”‚     â”œâ”€ Wait 15 seconds                            â”‚
â”‚     â””â”€ Curl /health endpoint                      â”‚
â”‚                                                     â”‚
â”‚  âœ… Deployment Complete                             â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Secrets Flow

### GitHub Secrets â†’ GCP Secret Manager

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GitHub Repository Secrets             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  GCP_PROJECT_ID_STAGING â”€â”€â”                     â”‚
â”‚  GCP_PROJECT_ID_PROD â”€â”€â”€â”€â”€â”€â”¼â”€â†’ Project Selectionâ”‚
â”‚                             â”‚                     â”‚
â”‚  GCP_SA_KEY_STAGING â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’ Authentication   â”‚
â”‚  GCP_SA_KEY_PROD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
          GitHub Actions Workflow
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Google Cloud Secret Manager              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  Staging Project Secrets:                        â”‚
â”‚  â”œâ”€ DATABASE_URL                                 â”‚
â”‚  â”œâ”€ JWT_SECRET                                   â”‚
â”‚  â”œâ”€ JWT_REFRESH_SECRET                           â”‚
â”‚  â”œâ”€ GOOGLE_CLIENT_ID                             â”‚
â”‚  â””â”€ GOOGLE_CLIENT_SECRET                         â”‚
â”‚                                                  â”‚
â”‚  Production Project Secrets:                     â”‚
â”‚  â”œâ”€ DATABASE_URL                                 â”‚
â”‚  â”œâ”€ JWT_SECRET                                   â”‚
â”‚  â”œâ”€ JWT_REFRESH_SECRET                           â”‚
â”‚  â”œâ”€ GOOGLE_CLIENT_ID                             â”‚
â”‚  â””â”€ GOOGLE_CLIENT_SECRET                         â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
         Injected into Cloud Run Service
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Running Container                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Secrets available as environment variables      â”‚
â”‚  process.env.DATABASE_URL                        â”‚
â”‚  process.env.JWT_SECRET                          â”‚
â”‚  etc.                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ Resource Configuration

### Staging Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Staging Configuration             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Memory:        512Mi               â”‚
â”‚  CPU:           1 vCPU              â”‚
â”‚  Min Instances: 0 (no idle cost)    â”‚
â”‚  Max Instances: 10                  â”‚
â”‚  Concurrency:   80                  â”‚
â”‚  Timeout:       300s                â”‚
â”‚                                     â”‚
â”‚  ğŸ’° Cost: ~$0-5/month               â”‚
â”‚  ğŸ¯ Purpose: Testing                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Production Configuration           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Memory:        1Gi                 â”‚
â”‚  CPU:           1 vCPU              â”‚
â”‚  Min Instances: 1 (no cold starts)  â”‚
â”‚  Max Instances: 100                 â”‚
â”‚  Concurrency:   80                  â”‚
â”‚  Timeout:       300s                â”‚
â”‚                                     â”‚
â”‚  ğŸ’° Cost: ~$10-30/month             â”‚
â”‚  ğŸ¯ Purpose: Live users             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Deployment Timeline

### Typical Deployment Duration

```
0:00  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  Start
0:30  â”œâ”€ Checkout & Setup             â”‚
1:00  â”œâ”€ Run Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
2:00  â”‚                               â”œâ”€â”¤  Total: ~3-5 min
2:30  â”œâ”€ Build Docker Image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
3:00  â”œâ”€ Push to GCR                 â”‚ â”‚
3:30  â”œâ”€ Deploy to Cloud Run         â”‚ â”‚
4:00  â”œâ”€ Run Migrations              â”‚ â”‚
4:30  â”œâ”€ Health Check               â”€â”˜ â”‚
5:00  â””â”€ Complete â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”˜
```

## ğŸ”„ Rollback Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Deployment Issue Detected        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  List Available Revisions           â”‚
â”‚  $ gcloud run revisions list        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Route 100% Traffic to Previous     â”‚
â”‚  $ gcloud run services update-      â”‚
â”‚    traffic ... --to-revisions ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Restored                   â”‚
â”‚  âœ“ Users see previous version       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Environment Labels

All deployed services are tagged with labels:

```yaml
Labels:
  environment: staging | production
  app: samaanai
  component: backend
  managed-by: github-actions
```

Use labels for:
- Cost tracking
- Resource organization
- Automated operations
- Monitoring and alerting

## ğŸ“ˆ Scaling Behavior

### Staging (Cost-Optimized)

```
Instances
    10 â”¤                    â•­â”€â•®
     9 â”¤                 â•­â”€â”€â•¯ â•°â”€â”€â•®
     8 â”¤              â•­â”€â”€â•¯       â•°â”€â•®
     7 â”¤           â•­â”€â”€â•¯            â•°â”€â•®
     6 â”¤        â•­â”€â”€â•¯                 â•°â”€â”€â•®
     5 â”¤     â•­â”€â”€â•¯                       â•°â”€â•®
     4 â”¤  â•­â”€â”€â•¯                            â•°â”€â•®
     3 â”¤â•­â”€â•¯                                 â•°â”€â•®
     2 â”¼â•¯                                     â•°â”€â•®
     1 â”¤                                        â•°â”€â•®
     0 â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       0     Traffic increases/decreases          Time

     Scale to 0 when no traffic
     Scale up based on demand (max 10)
```

### Production (Reliability-Focused)

```
Instances
   100 â”¤                              â•­â”€â•®
    90 â”¤                           â•­â”€â”€â•¯ â•°â”€â•®
    80 â”¤                        â•­â”€â”€â•¯      â•°â”€â•®
       â”¤                     â•­â”€â”€â•¯           â•°â”€â•®
       â”¤                  â•­â”€â”€â•¯                â•°â”€â”€â•®
       â”¤               â•­â”€â”€â•¯                      â•°â”€â•®
       â”¤            â•­â”€â”€â•¯                           â•°â”€â•®
       â”¤         â•­â”€â”€â•¯                                â•°â”€â•®
       â”¤      â•­â”€â”€â•¯                                     â•°â”€â•®
    10 â”¤   â•­â”€â”€â•¯                                          â•°â”€â•®
     1 â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       0           Traffic increases/decreases           Time

     Always 1 instance minimum (no cold starts)
     Scale up to 100 based on demand
```

## ğŸ¯ Success Criteria

### Staging Deployment âœ“

- [x] Tests passed
- [x] Docker image built
- [x] Pushed to GCR
- [x] Deployed to Cloud Run
- [x] Migrations executed
- [x] Health check passed
- [x] Service URL accessible

### Production Deployment âœ“

- [x] All staging criteria met
- [x] Staging thoroughly tested
- [x] Code reviewed and approved
- [x] Production secrets configured
- [x] Monitoring enabled
- [x] Rollback plan ready

---

**Last Updated:** 2025-10-05
**Version:** 2.0.0
